collisionless shocks are often considered to be particle accelerators of energetic , charged particles ( hereafter x - rays or crs ) . those devices play important roles in many astrophysical experiments . the theoretical basis of the cr - shock acceleration ( dsa ) theory is relatively well established through in - situ measurements of heliospheric shocks @ xcite and through experimental and mathematical calculations @ xcite . the test ##bed dsa and ##ers is relatively well established ; e . g . , @ xcite , it has long been recognized that dsa is an integral part of collisionless shock physics and that there are substantial and highly complex backreactions from the shock to the surrounding flows and to the mhd wave turbulence mediating the cr diffusive shock ( see , for example , @ xcite and references below ) . most critically , the shock waves absorb a large fraction of the total energy spread of the flows . as they diffuse upstream the crs form a pressure gradient that decelerates and traps the entering particles inside a broad shock field . that , in turn , can lead to greatly altered full shock response times , especially if the more energetic particles , which can have very large pulse lengths , escape the shockand carry significant energy with them . also in addition to the momentum dependent shock waves and flow speed variations through the shock , the cr particle distribution will take on different forms than in a classical model . both theoretical ( e . g . , @ xcite ) and numerical ( e . g . , @ xcite ) methods have been developed that allow one to compute steady - state modified shock properties with an appropriate thermal model . on the other hand , as the cr particle population evolves in time during the lifetime of such a shock the shock dynamics and the cr - scattering wave turbulence evolve as well . for dynamically unstable phenomena , such as supernova ##e , the time scales for shock modification can be comparable to the original time scales of the shock . the above considerations make it important to be able to use both nonlinear and time domain models for models of dsa . generally , two methods are called for . numerical plasma simulations provide the most complete time domain simulation of the dynamic shock microphysics @ xcite , but are far too expensive to model the shock evolution at the time , length and energy scales needed to calculate the cr acceleration . the most powerful alternative approach utilizes numerical methods , with a kinetic equation for each cr particle , with a modified compressible fluidthe equations for the bulk flow ( figure 2 ##b ) . by extending that definition further to include the wave action equations for the turbulent turbulence that mediates cr transport , a self - consistent , complete system of equations is obtained ( e . g . , @ xcite ) ) . continuum dsa calculations of the kind just described are still extremely challenging and expensive , with only one spatial dimension . the main difficulty arises especially from the very large range of cr ##s that must be followed , which typically amounts to hundreds of gev / s or more on the lower end and up to or close to those of the bulk plasma ##s , with nonrelativistic coefficients . the equations are needed in order to account for ` ` melting ' ' of crs due to incomplete thermalization that is characteristic of collisionless systems . one computational advantage arises from the fact that cr ##s of lengths from mhd ##s , @ xmath1 , are generally assumed to be increasing functions of the rigidity , @ xmath2 . the diffusion length relating the crs of a given length , @ xmath3 , to the bulk flow and defining the width of the resulting shock wave is the so - called diffusion length , @ xmath4 , where @xmath5 is the bulk flow speed , and @ xmath6 is the bulk flow speed into the shock . one must first use the standard shock model for the entire range of @ xmath7 in order to capture the physics of the shock formation and the spatial diffusion of the crs , in particular . the maximum @ xmath7 range spans several orders of magnitude , beginning close to the dissipation point of the thermal plasma , which is the boundary of the main , ` ` inner ' ' shock layer , also called the ` ` subshock ' ' in modified structure . this resolution requirement generally leads to very low cr ##s in comparison to the ` ` outer scale ' ' of the shock , which must exceed the threshold @ xmath7 . two approaches have been used , so far to manage this problem in dsa simulations . berezhko and colleagues @ xcite propose a method that replaces the local variable by @ xmath7 at the lowest moment of interest during solution of the shock kinetic equation . this method establishes an internal variable that varies only in tune with @ xmath7 . the cr wave functions of different momenta can be combined to provide feed - back to the bulk flow at thescales . the method is designed for use with the diffusion properties known _ a priori _ . it is most commonly applied to cr diffusion models with arbitrary , nonlinear feedback between the system and the crs . as an approach that can accommodate those latter diffusion properties , kang @ xcite have implemented the cr ##s into a multi - level adaptive mesh ##ing ( amr ) algorithm . the advantage of amr in this context comes from the feature that the higher resolutions are only necessary for close to the subshock , which can then be treated as a discontinuity satisfying standard rankine - hugoniot equations . through the use of spatial gridding both of these two methods can greatly reduce the cost of computation in dsa simulations . on the other hand , the two methods do not directly solve the principal computational problems in cr simulations , so they remain much more costly compared to purely hydrodynamic or mhd simulations . this is because the dependence of @ xmath8 on cr momentum , @ xmath3 , adds a new dimension to the problem . in particular , the relative value of the kinetic energy for each cr particle can be updated over the entire spatial domain using multiple momentum values ; say , @ xmath9 . the twoof @ xmath9 is very difficult , since the spanned dimension of cr ##s is typically several orders of magnitude . physically , crs evolve in free space during dsa in response to thermal changes in the fluid flow , sometimes through passive mechanisms ( see , for example , equation [ dce ] below ) , or because of other internal energy loss mechanisms , such as coulomb or radiative losses . the possible evolution rates for @ xmath8 depend on the process , but generally converge on @ xmath10 . the conventional approach to evolving @ xmath8 requires @ xmath10 through second order finite differences in @ xmath11 ( e . g . , @ xcite ) . research has shown that converged evolution of @ xmath12 using such methods requires @ xmath13 @ xcite . in that case , for example , a mere two decades of grid coverage requires fewer than 100 grid points in @ xmath14 . since spatial update of the momentum equations at each individual grid point requires computational time comparable to that for each of the accompanying hydrodynamical equations ( e . g . , the mass continuity equation ) , the momentum equation requires the computational effort of aa large number , commonly of an order of magnitude . an attractive alternative approach to evolving the kinetic ##s of @ xmath8 by integrating integral moments over a discrete set of finite momentum volumes , in which case @ xmath10 is replaced by @ xmath8 evaluated on the boundary of those volumes . the method we use now follows that strategy . because @ xmath15 is relatively smooth , simple subvolume models can only be applied over very large momentum volumes . we have found this method to give accurate solutions to the equations of @ xmath8 with an order of magnitude larger momentum volumes than needed in our original finite difference calculations . the computational cost to evolve the cr population is therefore reduced to a level similar to that for the equation . in recognition of the original name we refer to the method as ` ` coarse - grained , finite difference ' ' or ` ` cgmv ' ' . this extends related techniques found in @ xcite , @ xcite and @ xcite for test - mass models . those early models , while satisfactorily describing cr populations for many large - scale , smooth systems , did not include energy and momentum information , so could not explicitly model evolution of @ xmath8 duringdsa . instead , analytic , single - particle solutions for @ xmath12 are obtained at shock intensity . here we define the cgmv method so that it can be applied to the treatment of highly nonlinear cr modified systems . we outline the general cgmv method and its applications in eulerian diffusion codes in 2 . several experiments are performed in 3 , and our conclusions are reached in 4 . the standard diffusion - coefficient form of the diffusion equation for the behavior of the isotropic momentum distribution function , @ xmath16 , can be expressed in one spatial dimension as ( e . g . , @ xcite ) . @ xmath17 where @ xmath18 is the mean flow velocity , @ xmath19 , @ xmath20 is the charge diffusion coefficient , @ xmath21 is the momentum diffusion coefficient , and @ xmath22 is a representative source velocity . we can express the equation in units of @ xmath23 , where @ xmath24 is the particle velocity . the first rhs term in equation ( [ dce ] ) represents ` ` momentum transfer ' ' in relation to adiabatic contraction or expansion . for purposes of presentation , [ dce ]neglects for example much of the local turbulence with respect to the surrounding plasma , which can have a large effect when the elastic and alfvnic mach numbers of the flow are neglected . although it is fairly easy to include this effect , the equations are somewhat complex , so we leave that to a follow - up study focussed on cr transport in mhd terms . full solution of the problem at present requires simultaneous calculation of the hydrodynamical flow , as well as the diffusion coefficients , @ xmath20 and @ xmath21 . again postponing full mhd , the added equations to be solved are the standard gasdynamic equations with the coefficients included . expressed in the , eulerian formulation for two dimensional anti - stokes flow , they are @ xmath25 @ xmath26 @ xmath27 where @ xmath28 and @ xmath29 are the diffusion coefficients and the # ##s , respectively , @ xmath30 is the total energy loss of the particles per unit mass and the rest of the variables are their usual values . the total energy loss term , @ xmath31 , accounts for the energy of the suprathermal particles transferred at high temperatures to the crs. as such , mass inertia is important in these computations , since the mass fraction of the system is generally tiny . we note for completeness that @ xmath32 can be computed from @ xmath8 using the form @ xmath33 in the example given , we set the unit mass , @ xmath34 , for convenience . as shown in [ 2 ] , the local ##ization and diffusion terms of equation [ dce ] typically approximate @ xmath35 when using low dimensional finite element methods in the spatial domain @ xcite . the resulting large number of grid ##s in @ xmath36 makes finding the solutions of equation [ dce ] the dominate task in simulations of dsa . on the other hand , previous simulations of dsa as well as direct simulations of crs in different dimensions have shown that @ xmath12 is very well described by the form @ xmath37 , where @ xmath38 , is a time varying form of @ xmath36 . alternatively , we can use a piecewise powerlaw method to obtain an efficient and accurate , one - dimensional subgrid solution for @ xmath39 . two solutions of @ xmath12 are sufficient to recover thesubgrid of and . we find it convenient to evolve @ xmath40 and @ xmath41 the ratio of these moments , @ xmath42 , is proportional to the reynolds number density of gas in the [ \ @ xmath43 $ ] , while for this case , @ xmath44 is proportional to the temperature contribution and pressure contribution of gas in the bin . consider , for example , @ xmath45 , \ { { niq } \ ] ] where @ xmath46 , and @ xmath47 with the ratio to @ xmath44 . both of these moments , and their ratio , @ xmath48 , can be used in different ways ( e . g . , iteration ) to evolve the @ xmath49 and the intrabin ##ding , @ xmath50 . to evolve @ xmath42 and @ xmath44 we use the associated solution of equation [ dce ] for the same volume , given by @ xmath51 . the result for @ xmath42 is @ xmath52 where @ xmath53 is a four - dimensional space , with @ xmath54 , and where @ xmath##55 and @ xmath56 are measured over the time interval , according to @ xmath57 and @ xmath58 extension of the energy flux of @ xmath59 to include other processes such as radiative or thermal losses is possible ( e . g . , @ xcite ) . in general these processes should be upwinded according to the values of @ xmath60 and @ xmath61 . evaluation of @ xmath59 and @ xmath62 at the end of the maximum momentum range requires application of suitable boundary conditions , of course . we usually just set @ xmath63 . in most cases we have a sufficiently large maximum momentum , @ xmath64 , that this condition becomes satisfied only later in the analysis , if at all . the formulas for the lowest momenta can be more complicated , depending on how one wishes to relate the electromagnetic particle distribution to the thermal energy distribution , as in the injection models discussed above . the @ xmath44 - associated moment of equation [ dce ] is @ xmath65 where @ xmath66 , @ xmath67 @ xmath68 , and @ xmath69 are given byan alternative approach to equation [ sni ] . we note that momentum binning in the cgmv scheme is quite flexible , so that it can be easily adapted to either uniform or variable momentum bin ##s , according to the momentum range that changes during the experiment . we have successfully obtained both nonuniform and variable momentum bin ##s , although , for convenience we do not mention them here . the solutions of equation [ cne ] are obtained with the aid of the solutions to equations [ masscon ] - [ encon ] , which are obtained prior to solutions of equations [ dce - f ] and [ dce - g ] . we note again that similar methods can be used to model the evolution of the wave turbulence that resonantly produces crs and that defines the spatial and temporal diffusion coefficients . in that case one starts with the wave action equation for the target particle rather than the particle kinetic equation ( e . g . , @ xcite ) . the solution of equation ( [ cne ] ) for either @ xmath42 or @ xmath44 is also analogous to our own fd method . thus , since the cgmv scheme uses two waves rather than one , the computational time required for a given@ xmath9 is approximately equal in the cgmv to that required by the fd scheme . our tests confirm this by experiment . on the other hand , since @ xmath9 can be significantly reduced in the cgmv , the method can still be more efficient by a large factor . the most common source model used for @ xmath22 in physics ( [ dce ] ) is injection at the source of low - crs from the gas plasma . there is currently no generally accepted theory for that effect . however , we have integrated several commonly used models successfully into the cgmv scheme . for completeness we compare those models . the simplest and one of the most widely applied source models is that a small , fixed amount of the incident particle flux through the plasma subshock , @ xmath77 , is injected at a constant @ xmath78 , where @ xmath79 is a constant greater than unity and @ xmath80 is the plasma sound density immediately downstream of the subshock ( e . g . , @ xcite ) . this gives @ xmath81 , where @ xmath82 is the plasma mass density immediately upstream of the subshock , @ xmat##h83 is the plasma mean particle mass , @ xmath6 is the subshock speed with respect to the plasma velocity , and @ xmath84 is the normalized weight function that allows the injection to be distributed across the numerical shock region . in this case @ xmath85 , while @ xmath86 in the momentum bin with @ xmath87 . both @ xmath88 and @ xmath69 are zero , otherwise . the energy fraction from the thermal proton is simply @ xmath89 . for simplicity we call this energy fraction the ` ` energy fraction ' ' or ` ` ff ' ' ' . a more sophisticated approach to plasma physics includes consideration of the physical laws moderating particle velocity in the numerical shock flow , in order to estimate the probability that particles of a given size will be able to escape from upstream , across the subshock . in such ` ` ' leakage ' ' ( fc ) model for the injection at shocks , most of the incoming thermal protons are still driven by the mhd , and only those well into the tail of the postshock maxwellian flow will leak back across the subshock . in particular , ` ` f ' ' is notparticles must have velocities high enough to push against the shock flow in order to return to the plasma , they must also be being absorbed during that time by the mhd particles that mediate the initial subshock . to model tl , we use the ` ` step function ' ' , @ xmath90 , for the probability that supra - particle particles of a given size can move upstream from within the subshock ( see @ xcite for details ) . in general we have @ xmath91 { ( 1 - \ frac { 1 } { \ dot { \ tau } } ) \ { ( 1 - \ frac { u _ b } { \ right } ) } \ exp \ left \ { - \ left [ \ tilde { \ upsilon } - ( 1 + \ u _ b ) \ } ] ^ { - 2 } \ right \ } , \ dot { tau } \ ] ] where @ xmath92 is the postshock flow speed in the subshock region , @ xmath93 is the flow step function , and the flow velocity is equal to @ xmath94 . the parameter , @xmath95 , is the ratio of the amplitude of the postshock mhd shock turbulence @ xmath96 to the general velocity field associated with the shock wave , @ xmath97 . the above models and theory show that @ xmath98 @ xcite , and that the shock is tightly constrained . with this @ xmath99 the shock becomes virtually ` ` transparent ' ' to particles with moments less than @ xmath100 , _ @ xmath101 for @ xmath102 , where @ xmath103 . so @ xmath104 is the lowest value of the first momentum bin in the tl model and increases in magnitude with the postshock flow speed . for @ xmath105 , @ xmath106 . the shock becomes virtually transparent to particles with moments two to three moments less than @ xmath100 . for example , the equations @ xmath100 in the cd model and @ xmath107 in the ff model are equivalent when @ xmath105 and @ xmath108 . under those conditions the shock injection rates will be roughly constant , although , in model .leading to different results as the equations are modified ( see , e . g . , @ xcite , @ xcite , @ xcite ) . the cr model is solved in the cgmv method using the following numerical approach . after solution of equations ( [ dce - f ] ) and ( [ dce - g ] ) the energy losses in @ xmath42 and @ xmath44 are calculated ( estimated ) in the critical region by application of the transfer function as follows : @ xmath109 and @ xmath110 where @ xmath111 , found from equation ( [ niq ] ) , is the temperature distribution associated with equations ( [ dce - n ] ) and ( [ dce - g ] ) . the energy transfer rate of the resulting system to fall into the @ xmath112 - th angular temperature distribution can be calculated : @ xmath113 ( see @ xcite ) . with the step - wise power - law subgrid model ( @ xmath114 ) the losses in : ( [ leakn ] ) - ( [ leakl ] ) can be calculated : @ xmath115 @ xmath116 and @ x##math117 in general , this leakage error is significant only for the first few possible bins , so that this scheme need not be applied to all bins . in order to improve the accuracy of the new cgmv scheme we have installed it into two , 3 - dimensional eulerian hydrodynamic ( hd ) codes that we have previously applied to studies of cr - modified shocks using the finite difference ( fd ) methods to solve the diffusion diffusion equation . in this section we will describe the results and compare the cgmv and fd codes . both of the host hd codes are constructed from first order , conservative , energy - based schemes designed to reduce shocks intensity . here we describe data from the cgmv scheme installed into a second , ` ` total energy diminished ' ' ( tvd ) hd code based on the finite difference scheme of harten @ xcite . this is the hd version of the mhd - hd code used by us in our recent study of cr modified shocks @ xcite . gas subshocks in the tvd scheme typically spread over 2 - 3 spatial dimensions . an outline of the wave mechanics and the fd coding scheme can be found here , in @ xcite and also discussed in those papers .the fd tests employed a wheeler - nicholson routine first introduced in @ xcite for the @ xmath118 that is similar to the ( [ cne ] ) . for the tvd tests we use the ff ##d model . in this we present cgmv tests carried out with our x ##cite adaptive refinement method ( crash ) code . crash is based on the high order wave - like shock tracking algorithm of leveque @ xcite . the crash routine in that code uses a modified riemann solver to model shock discontinuities in the zones of an initially stable system . thus , the subshocks and time - modified shocks remain constant throughout a system , allowing the transport to be modeled very close to the limit of the initial system size . crash also employs adaptive model refinement ( amr ) of shocks in order to reduce the computational effort on the spatial grid . refinement is based on the subshock and each level has several layers with a resolution twice as fine as the level above it . the number of different layers depends on what is needed to capture diffusion of the lowest order crs . the standard , well known version of crash uses the same fd algorithm .the tvd code to solve the mean convection equation for cr shocks . it is described as @ xcite and @ xcite . for the crash tests described in this paper we use the # ##v code . we first get some results from using the tvd - v code with both fd and cgmv schemes , to model the evolution of a given cr - modified shock . fig . 1 and fig . 2 illustrate the sequence of shocks formed by the reflection of a mach number flow ( thermal index , @ xmath119 ) on the left grid surface . the resulting cr - modified shock also has a mach number , @ xmath120 . the flow and sound speed of waves entering from the right grid were scaled to @ xmath121 and @ xmath122 , respectively , so that the inflow velocity was unity . the time unit for the shock was also determined from these scalings . in order to relate hydrodynamical variables to cr shocks it is necessary to plot the mean convection speed ( the sound speed in all the simulations described in this paper ) with respect to the speed of light ; i . e . , @ xmath123 . we use @ xmath124 in thetvd - based model . the steps were fixed by a modified courant distribution , @ xmath125 . for the simulation shown in fig . 1 , of the cr distribution is followed by the energy distribution @ xmath126 = [ 2 \ times 10 ^ { - 4 } , 1 . 6 \ times 10 ^ 3 ] $ ] ( @ xmath127 ) . the simulation shown in fig . 2 shows the momentum distribution @ xmath126 = [ 2 \ times 10 ^ { - 4 } , 1 . 6 \ times 10 ^ 3 ] $ ] ( @ xmath128 ) . the cr diffusion coefficient , @ xmath20 is spatially uniform and equal to @ xmath129 . in a search for a reasonably generalized behavior that required less computational effort , this approach was motivated by results from malkov , who found self - consistent , steady - state solutions for the time - modified shocks that lead to the powerlaw index of @ xmath130 , as long as the powerlaw index is steeper that @ xmath131 @ xcite . however , our @ xmath20 solution leads to a generalized nonlinear behavior in a way that reduces the complexity of the2 . that space , which is the minimum space that can be simulated ahead of the subshock , is given by @ xmath132 , where @ xmath133 is the maximum space width . the tvd - cr simulations utilize a small , fixed volume , so , for example , the bohm ##ian form used in the crash simulations below would lead to computational complexity for the tvd - cr fd crash simulations presented in this article . the maximum resolution required for the calculations is set by @ xmath134 , since the solutions of the shock - diffusion equations require certain physical properties in the upstream cr precursor ##s of the subshock . several experimental studies have shown that @ xmath135 is desirable ( e . g . , @ xcite ) . for the problems illustrated in fig . 1 and fig . 2 these results allow us to set @ xmath136 for both the fd and cgmv simulations . by varying this resolution , we find that the population density is approximately linear with respect to @ xmath137 . the simulation shown in fig . 1 assumes a pre - existing cr population , @ xmath138 , corresponding to an upstream cr pressure , @ xmath##139 . no fresh injection is required at the end ; i . e . , @ xmath140 . this test then provides a quick and accurate comparison between the cgmv and fd schemes for solving the diffusion - convection equation , since it avoids the complications related to the injection model . this simulation pair evolves the system until @ xmath141 , which is sufficient to accelerate crs to ultrarelativistic speeds . the spatial resolution spans the interval [ 0 , 1 ] , which is sufficient to contain the leading edge of the shock precursor to the rest of the simulation . the cr - related shock wave equations and the shock energy distribution of the subshock are shown in fig . 1 at times @ xmath142 . by comparing the solutions obtained with the two simulation pairs , it is useful to describe briefly the physics observed during the shock evolution . all the physics described here have been reported previously by the authors . the figure illustrates the well - known result of the modified model that the crs carries most of the heat flux into the system . that corresponds to a small drop in the postshock density pressure , @ xmath143 , and a large drop in the postshock density , @ x##math144 . 1 those have a strongly reduced postshock gas temperature . the decreased temperature is evident in the @ xmath145 phase of the subshock , which is dominated at low momenta by the maxwellian motion of the bulk gas . as they move upstream against the inflowing flow they compress the flow of the precursor , preheating the system ( adiabatically in these simulations ) . however , since the cr diffusion is relatively weak compared to the incoming momentum flux , the initial subshock is strong enough to produce a full four ##fold density compression on top of the precompression . however , the subshock occurs after @ xmath146 , increasing the subshock compression in this case to a maximum @ xmath147 , corresponding to a subshock mach number of 1 . 5 . that evolution produces the well - defined , transitory ` ` density compression ' ' in the gas structures immediately after @ xmath148 . we note that since energy released from the gas during shock becomes increasingly spread upstream and downstream due to cr diffusion , the total energy of such an _ h _ modified shock would always exceed the factor of seven one would expect for a strong , fully re##lativistic gas shock . for this reason no significant gas ##s cross the spatial grid through spatial diffusion . however , at late times ( @ xmath149 ) the high pressure due to crs just above @ xmath150 is sufficient that escape across the gas phase boundary becomes significant . this contributes to the overall decrease of @ xmath32 during the shock and the increasing total compression through the phase boundary that is visible in fig . 1 . in the early evolutionary stages of this flow , when shock modification is modest , the cr momentum distribution takes the powerlaw form , @ xmath151 , predicted by free particle theory for a gas precursor ( e . g . , @ xcite ) . with the spatial diffusion model , in this simulation the high momentum cutoff to the precursor increases with time approximately above @ xmath152 ( see , e . g . , @ xcite ) . as shock stress increases , most of the total compression occurs from the subshock to the precursor . the dsa of high velocity flow occurs predominantly within the precursor rather than in the most recent subshock . thus the cr distribution develops the characteristic upwards - sloping shape resulting from the momentum - cr bond length . crs of higherthey have a greater velocity than within the system , but lose more energy each time they are reflected within the shock structure . that flattens the distribution , @ xmath12 at or below @ xmath133 . the result is a bump in the distribution of @ xmath118 . on the other hand , crs with energies only a little above the normal range are trapped prior to the subshock . their shape closely resembles the ground state , powerlaw , life - form prior to the initial subshock . that feature grows rapidly in size as the distribution of @ xmath133 moves upwards . looking finally to compare the two methods used to evolve the shock structure shown in fig . 2 we have results from the fd scheme with @ xmath153 and the cgmv scheme with @ xmath154 . the comparison is generally very good . all the measured quantities , the velocity , and the cr momentum , show excellent agreement . the curves representing the fd and cgmv distributions of @ xmath144 , @ xmath143 and @ xmath32 and virtually indistinguishable in the diagram . most importantly , all curves formed in the fd evolution ofthe cr momentum distribution is faithfully replaced by the much simpler cgmv distribution . given the direct comparison of this slightly modified solution it is satisfying to note that the execution time required for the cgmv solution is a little less than 50 % of that for the fd solution , despite the significantly higher efficiency of the former method . the match - up rate between our discussion of the two methods is largely in agreement with what we would expect for a small scale system in the range of the values used , since the cgmv method requires one to evolve the values @ xmath42 and @ xmath44 for each momentum bin . we note this with respect to the resolution in our discussion of the former method . fig . 2 shows a mach number simulation similar to that in fig . 1 . in this case ff injection is performed with commonly used values , @ xmath155 and @ xmath156 ( see 2 . 3 ) , the cr momentum bound is extended to @ xmath157 and the spatial grid extends farther from the piston to @ xmath158 . a large pre - existing cr population is used to solve numerical issues arising from the fact that our cgmv solution requires expansion of the distribution @ x##math159 for the entire grid . the simulations contain the shock until @ xmath160 , which leads to @ xmath161 . the entire grid , in the interval [ 0 , 1 ] , is sufficient to contain the cr leading edge of the shock up to the end of the simulation . however , after @ xmath162 some cr energy escapes through the right boundary , due to diffusion upstream , changing the behavior of the ` ` free escape ' ' boundary ( s ) ( e . g . , @ xcite and see below ) . just as for the shock simulated in fig . 2 , this energy transfer amounts to a side effect , so that the resulting shock compression increases with time until the simulation ends . } the relationship between fd and cgmv simulations is very complex . very early in the simulation of the shock , when the collisions are dominated by freshly charged nonrelativistic particles , the shock absorption is much stronger in the cgmv scheme . that absorption becomes stronger later on , so that the resulting energy distributions produced by the two simulations are almost identical as is the distribution @ xmath118 for the shock . there is a small side effect that the position of the subshock in thecgmv simulation lags slightly behind that of the fd simulation , and that @ xmath32 is slightly behind in the cgmv simulation for the piston , where the shock is formed . since the advantage of the cgmv method comes from its ability to estimate the momentum range coarsely , it is important to understand how wide the momentum range can be and to faithfully model the evolution of the system . 3 illustrates convergence of the cgmv scheme with respect to the bin size , @ xmath163 , and @ xmath164 for the system modeled in fig . 2 . the upper panel shows the relative @ xmath32 solution , while the lower panel plots the relative momentum distributions for the first subshock . for reference the closest fd solution ( @ xmath153 ) is shown in the two red curves . solutions from the cgmv scheme are shown for @ xmath165 , @ xmath166 and @ xmath167 . all the behavior of the cgmv solutions is in basic agreement with the closest cgmv solutions and with the fd solution . the details of the momentum distribution are naturally obscured as the cgmv bin size increases . the largestexperiments with @ xmath168 take a decade in cr time ( @ xmath169 ) , but still reproduce the basic physical properties of the flow system . however , the accuracy of the cgmv model deteriorates for still larger momentum bins in these experiments , once the simple subgrid model for the cr distribution becomes inadequate . as illustrated in the second panel of fig . 1 already momentum bin larger than roughly @ xmath170 do not always capture sharper structures in the flow distibution that develops at the boundary of the cr distribution . that requires @ xmath32 prediction of the subshock , where the flow is both smooth and slightly curved as it approaches the subshock . when the errors become larger , for @ xmath171 , in this case , @ xmath32 - induced overcompression in this region can cause the flow equations in our tvd code to perform poorly or even to fail in high reynolds number conditions . in determining the maximum possible momentum bin ##s , @ xmath172 should depend on the strongest curvature of the cr momentum distribution , as well as the degree of shock modification . for the third such case we illustrate in figs. . and the simulation results in the crash code with the cr injection parameter applied to the mach number wave flowing off the magnetic field boundary . the initial bow ##e mach number is about 0 . 5 for the previous example , the initial gas pressure and flow speed are set to unity , with the flow speed , @ xmath173 , and @ xmath174 . the time interval is defined accordingly . the momenta are tracked over the range @ xmath175 $ ] , where @ xmath104 is the only gas that can leak upstream ( see figure 15 ) . in this case the bohm - type gas model with @ xmath176 , is used and the tl injection parameter , @ xmath177 is used . the crash simulation was significantly more computationally demanding than the tvd - cr simulation . note , that in the crash code the value of @ xmath178 , while @ xmath179 in the previous example shown in fig . 1 - 3 . consequently , @ xmath180 is about seven times larger in the current case , and the nominal time scale of the precursor and the formation timescale are significantly lengthened . in addition , the gas momentum dependenceof bohm diffusion length means that the resulting shock expands more rapidly as @ xmath133 increases . the average diffusion rate of increase for @ xmath133 is , therefore , slower , so that the shock will evolve faster to reach a given @ xmath133 . these factors substantially increase the size of the physical domain required to reach a given @ xmath133 . 4 is the early evolution of this cr - modified shock for @ xmath181 , compared with both the fd and the cgmv simulations . the physical domain for this simulation is [ 0 , 1 ] . the corresponding refined grid is @ xmath182 + , for @ xmath183 . since it is possible to resolve structures near the subshock on top of the diffusion length for the injected , suprathermal shock , the amr version of the cr model is useful . the fd simulation is carried out with 3 basic grid levels ; 3 levels of the grid are used in the cgmv simulation . 240 momentum points ( @ xmath184 ) are used in the fd simulation , while the cgmv simulation includes 20 momentum points ( @ xmath185 ) . the timestep for each refinement problem , @ xmath186 , is determined by a single courant number , that is , @ xmath187 . although the crank - nicholson problem is solved with an initial time step , the diffusion convection problem is solved with the time step smaller than @ xmath188 ) to achieve higher accuracy in the phase space advection ( _ i . e . , _ @ xmath189 ) . with @ xmath184 , the required time step is increased by a factor of 2 times more than the hydrodynamic time step in the fd simulation . consequently , the fd diffusion convection solver is only subcycled by 3 times with @ xmath190 for the required time step . because of the much larger @ xmath163 , subcycling is not possible in the cgmv simulation . that adds another computational economy to the cgmv simulation . at the end of this simulation , @ xmath191 , the modified shock structure is in a stable state in the sense that the postshock states of @ xmath144 , @ xmath143 and @ xmath32 can bechange occurs at later times . since this effect is smaller than the mach number shocks examined the modifications are more moderate . on the other hand , as seen from the high momentum flux of @ xmath7 , the surface area changes much more quickly in the present case . the solution of the present model is reached from @ xmath192 by @ xmath191 . the term evolution of this model will be shown here . the difference between the fd and cgmv solutions shown in fig . 3 is close , although not as close as it was to the case illustrated in fig . 1 and fig . 2 . the more apparent distinctions between the two solutions in the present case come from effective differences in the integration of the tl injection coefficients with bohm diffusion , fd and cgmv methods . recall that the cgmv scheme averages the diffusion coefficients uniformly across the particle bins ( see equations [ kni ] , [ kgi ] ) . the bohm diffusion model has a very strong momentum dependence for nonrelativistic particles ; namely , @ xmath193 . at low energies where injection takes place the averaging of the effective diffusion coefficient , and , therefore , the momentum flux of suprathermalparticles , leading to higher injection rate compared to the fd scheme for the same tl and parameters . consequently , the distribution function of the second bin at @ xmath194 is slightly higher in the cgmv scheme , as evident in figs . 2 that @ xmath195 is based on the assumption of maxwellian distribution . the cgmv solutions also show slightly more negative cr acceleration than the fd solution at early speeds . in this test @ xmath32 is about 10 % faster in the cgmv scheme than @ xmath191 . since the cgmv scheme can be used with different energy distributions , such acceleration could be reduced by making the two distributions smaller at early speeds in instances where the details as to the injection rate were different . we show in fig . 2 the evolution of this method is applied to @ xmath196 , as computed with the cgmv method . this result is computed on the grid [ 0 , 800 ] , spanned by a base - set of @ xmath197 zones , giving @ xmath198 . we also show the refined energy distribution of the subshock , giving @ xmath199 . this grid spacing isallow for peaking in the injection momentum , @ xmath200 , so that the very early evolution is much slower than for the simulations shown in figure . however , when shock modification becomes necessary evolution becomes roughly self - similar , as pointed out in @ xcite . the time - states do not depend sensitively on the observed event rate . the self - similar evolution results with bohm diffusion from a transition between the upstream and downstream extensions of the cr population . one also sees from the structure of the distribution shown in fig . 2 that the postshock gas population has increased , and the above - mentioned transition back to the cr population is better behaved than it was in earlier times . this model reduces nicely the computational cost of the cgmv model . the original fd scheme would be very much more expensive , because this model requires a long computation time and a large time domain . with bohm diffusion @ xmath201 for ultrarelativistic simulations , assume that the size of the system , @ xmath202 . at the same time the peak in the injection momentum distribution extends relatively slowly , with @ xmath203 . the required spatial grid is , thus , many times longer than for the shorter simulation illustrated infig . the simulated time interval in the extended simulation was 50 times longer . together those increase the total simulation time by a factor 2000 . the fd calculation with @ xmath204 $ ] to @ xmath205 took about 10 cpu days on our fastest personal computers , so the extended simulation would have been done by the fd method . the extended cgmv simulation , however , required only about 10 times the time of the original fd calculation , clearly demonstrating the efficiency of the cgmv scheme . this speed - up is the result of one of several factors : 20 times larger bin ##s , no need for subcycling for the diffusion equation solver , and , of course , a larger number of momentum bins . the time series simulations of nonlinear cr shock waves are less expensive if one allows for inclusion of linear , self - consistent and possibly time dependent spatial transport , as well as many other time dependent transport behaviors . the principal computational tool for such calculations is typically the cr transport itself , and , for self - consistent calculations , the spatial transport of the mhd wave function that drives cr transport . modeling these behaviors requires adding at least one spatial dimension to the simulations and to the underlying hydrodynamical model , sincethe collisionless media themselves are sensitive to the momentum space configurations of the particles and waves . the kinetic equations ( including the so - called diffusion convection equations ) provide a straightforward approach to addressing this problem and can be combined conveniently with hydrodynamical equations that model liquid and bulk motion and flow effectively . momentum derivatives of the cr distribution function in the diffusion convection equation are most frequently represented by finite differences . although it is efficient , that approach requires moderately high volumes in momentum space . that is a primary reason that such calculations are difficult . here we propose a simple method to solve the diffusion convection equation based on finite volumes in momentum space with a momentum bin size as much as an order of magnitude larger than that of the usual finite difference approach . we demonstrate that this coarse grained averaging per volume ( cgmv ) approach can be used successfully to model the behavior of strong , time - modified shocks at much lower computational cost than the finite difference approach . the computation efficiency is greatly increased , not only because the number of diffusion matrices is smaller , but also because the required spatial grid size is less demanding compared to the coarse - grain averaging of the diffusion processes used in the cgmv method . in addition , the momentum bin ##s can solve the problem of subcy##cling of the thermal convection solver that can be solved in some cases with finite differences in temperature . finally , the combination of the cgmv scheme with amr techniques as developed for our original model , for example , should allow for the analysis of the diffusive shock acceleration associated with a simple time dependent diffusion model such as bohm diffusion , or self - consistent treatments of cr diffusion and wave ##front transport . twj was supported by esa grant ast03 - 07600 , by nasa grants nag5 - 10774 , nng05gf57 g and by the university of washington supercomputing center . hk was supported by kosef and the astrophysical research institute for the structure and evolution of galaxies ( hk ) . . red lines and curves were calculated using the same cgmv scheme with @ xmath154 . the curves are almost identical . the pre - existing cr population , @ xmath138 , similar to the initial cr population , @ xmath139 is used , without the injection of the shock ( @ xmath206 ) . ] at @ xmath160 for the same solution as shown in fig 2 . the red curvesthe results obtained using the fd method and the different momentum resolutions with the cgmv scheme . bottom : the # ##c function for the shock from the same source . ] and @ xmath207 , respectively . the black horizontal lines represent solution at @ xmath205 with the conventional finite element method with 240 momentum bin ( @ xmath184 ) . the red lines x and x s represent cgmv solutions at @ xmath208 and respectively with 20 momentum bin ( @ xmath185 ) . ]